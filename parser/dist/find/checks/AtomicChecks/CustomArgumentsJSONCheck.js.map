{"version":3,"sources":["../../../../src/find/checks/AtomicChecks/CustomArgumentsJSONCheck.js"],"names":["linenumber","sourceTypes","severity","confidence","CustomArgumentsJSONCheck","constructor","id","description","type","JSON","shortenedURL","dangerousArguments","match","content","npmScripts","json","scripts","undefined","npmConfig","config","location","Object","keys","length","script","hasOwnProperty","res","some","arg","stringify","toLowerCase","includes","ln","text","push","line","column","MEDIUM","TENTATIVE","manualReview"],"mappings":"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","file":"CustomArgumentsJSONCheck.js","sourcesContent":["import linenumber from 'linenumber';\n\nimport { sourceTypes } from '../../../parser/types';\nimport { severity, confidence } from '../../attributes';\n\nexport default class CustomArgumentsJSONCheck {\n  constructor() {\n    this.id = 'CUSTOM_ARGUMENTS_JSON_CHECK';\n    this.description = `Search for dangerous runtime flags in the package.json file.`;\n    this.type = sourceTypes.JSON;\n    this.shortenedURL = \"https://git.io/Jeu1j\";\n    this.dangerousArguments = [\n      \"--ignore-certificate-errors\",\n      \"--ignore-certificate-errors-spki-list\",\n      \"--ignore-urlfetcher-cert-requests\",\n      \"--disable-web-security\",\n      \"--host-rules\",\n      \"--host-resolver-rules\",\n      \"--auth-server-whitelist\",\n      \"--auth-negotiate-delegate-whitelist\",\n      \"--js-flags\",\n      \"--allow-file-access-from-files\",\n      \"--allow-no-sandbox-job\",\n      \"--allow-running-insecure-content\",\n      \"--cipher-suite-blacklist\",\n      \"--debug-packed-apps\",\n      \"--disable-features\",\n      \"--disable-kill-after-bad-ipc\",\n      \"--disable-webrtc-encryption\",\n      \"--disable-xss-auditor\",\n      \"--enable-local-file-accesses\",\n      \"--enable-nacl-debug\",\n      \"--remote-debugging-address\",\n      \"--remote-debugging-port\",\n      \"--inspect\",\n      \"--inspect-brk\",\n      \"--explicitly-allowed-ports\",\n      \"--expose-internals-for-testing\",\n      \"--gpu-launcher\",\n      \"--nacl-dangerous-no-sandbox-nonsfi\",\n      \"--nacl-gdb-script\",\n      \"--no-sandbox\",\n      \"--reduce-security-for-testing\",\n      \"--unsafely-treat-insecure-origin-as-secure\"\n    ];\n  }\n\n  async match(content){\n    const npmScripts = content.json.scripts ? content.json.scripts : undefined; //https://docs.npmjs.com/misc/scripts\n    const npmConfig = content.json.config ? content.json.config : undefined; //https://docs.npmjs.com/misc/scripts#special-packagejson-config-object\n\n    let location = [];\n\n    // We look for \"scripts\" key-values\n    if (npmScripts && Object.keys(npmScripts).length > 0) {\n\n      for (var script in npmScripts) {\n        if (npmScripts.hasOwnProperty(script)) {\n\n          var res = this.dangerousArguments.some(function(arg) {\n            return JSON.stringify(npmScripts[script]).toLowerCase().includes(arg);\n          });\n\n          if (res) {\n            let ln = linenumber(content.text, npmScripts[script]);\n            location.push({ line: ln[0].line, column: 0, id: this.id, description: this.description, shortenedURL: this.shortenedURL, severity: severity.MEDIUM, confidence: confidence.TENTATIVE, manualReview: false });\n          }\n\n        }\n      }\n    }\n\n    // We look for \"config\" key-values\n    if (npmConfig && Object.keys(npmConfig).length > 0) {\n      for (var config in npmConfig) {\n        if (npmConfig.hasOwnProperty(config)) {\n\n          var res = this.dangerousArguments.some(function(arg) {\n            return JSON.stringify(npmConfig[config]).toLowerCase().includes(arg);\n          });\n\n          if (res) {\n            let ln = linenumber(content.text, npmConfig[config]);\n            location.push({ line: ln[0].line, column: 0, id: this.id, description: this.description, shortenedURL: this.shortenedURL, severity: severity.MEDIUM, confidence: confidence.TENTATIVE, manualReview: false });\n          }\n\n        }\n      }\n\n    }\n    return location;\n  }\n}"]}